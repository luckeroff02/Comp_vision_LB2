# Comp_vision_2
## Введение
В этой работе я исследовал математические методы поиска и сопоставления ключевых точек на последовательности изображений. Цель — определить смещение камеры между кадрами. Для экспериментов использовались 4 фотографии с постепенным сдвигом:  
![крыса](https://github.com/luckeroff02/Comp_vision_2/blob/main/initial.png)

## Подготовка изображений
Перевод в одноканальное представление упрощает вычисления без потери важной информации:  
- Один канал интенсивности вместо RGB
- Сохраняется контраст — ключевой параметр для детектирования
- Уменьшаются вычислительные затраты  
![grayscale](https://github.com/luckeroff02/Comp_vision_2/blob/main/gray.png)  

## Выравнивание яркости  
Дескриптор ключевой точки (keypoint descriptor) — это числовое представление окрестности ключевой точки, которое описывает её уникальные характеристики. Дескриптор позволяет сравнивать ключевые точки между изображениями и определять их схожесть, даже если изображения подверглись изменениям.  
Разная яркость изображений может повлиять на формирование дескриптора, а при сопоставлении изображений многие алгоритмы опираются на сравнение дескрипторов ключевых точек. Если дескрипторы различаются из-за различий яркости - это может привести к ошибочным соответствиям или недостатку хороших совпадений. Поэтому выберем метод и выровняем яркость изображений.   
Для выравнивания яркости будем использовать метод линейной трансформации яркости и выровняем яркость второго изображения относительно первого.  
Чтобы сравнение точек между кадрами было корректным, применил линейную трансформацию:  
- Вычислил mean и std для каждого изображения
- Масштабировал яркость: I' = (std₁/std₂)·(I - mean₂) + mean₁
- Обрезал значения к диапазону [0, 255]  
Результат нормализации:  
 ![histogram](https://github.com/luckeroff02/Comp_vision_2/blob/main/brightness.png) 

## Детектирование ключевых точек
Использовал связку операторов:  
1. Гауссово сглаживание — убирает высокочастотный шум
2. Лапласиан — выделяет области с резкими перепадами
3. Детектор Харриса — находит угловые точки  
Математическая основа:  
![matrix](https://github.com/LugenderGeist/computer_vision_2/blob/main/matrix.PNG)  
Ответ Харриса - результат работы с матрицей, по значению которого можно определить, является ли точка ключевой.  
![harris](https://github.com/LugenderGeist/computer_vision_2/blob/main/harris_answer.PNG)  
Получим следующие ключевые точки на изображениях:  
![keypoints](https://github.com/luckeroff02/Comp_vision_2/blob/main/key0.png)  

## Фильтрация ключевых точек
Для фильтрации ключевых точек используется метод адаптивного радиуса, который позволяет оставить только наиболее значимые и информативные точки, удаляя избыточные. Сначала все обнаруженные точки сортируются по степени их значимости, определяемой величиной отклика детектора. Затем алгоритм последовательно обрабатывает точки, начиная с самой значимой: для каждой выбранной точки в заданном радиусе удаляются все соседние точки, сохраняя только одну - наиболее важную в данной области. Этот процесс повторяется для всех оставшихся точек, в результате чего получается оптимально распределенный набор ключевых точек, где каждая точка представляет уникальную и информативную область изображения. Такой подход обеспечивает равномерное покрытие изображения ключевыми точками без избыточного дублирования в одной области, что значительно улучшает качество последующего сопоставления между изображениями и повышает точность определения траектории движения камеры.   
![filtered](https://github.com/luckeroff02/Comp_vision_2/blob/main/key_final.png)  

## Сопоставление точек
Для эффективного сопоставления ключевых точек между разными изображениями используется подход на основе дескрипторов — числовых векторов, характеризующих локальные особенности окрестности каждой точки. Процесс создания дескрипторов включает несколько этапов: вокруг ключевой точки выделяется анализируемая область, в которой вычисляются градиенты яркости, определяются их величины и направления. Эти данные затем квантуются в гистограмму ориентаций, где каждому угловому диапазону (бину) соответствует накопленная "голосами" пикселей величина градиента.  
Для быстрого поиска соответствий между тысячами таких дескрипторов применяется оптимизированная структура данных — cKDTree. В отличие от полного попарного сравнения, это дерево рекурсивно разделяет многомерное пространство признаков, последовательно отсекая половину возможных вариантов на каждом шаге. Такой подход радикально сокращает вычислительную сложность с O(n²) до O(n log n), позволяя находить ближайших соседей для каждого дескриптора за логарифмическое время. Особенно важно, что метод сохраняет точность сопоставления, сравнивая каждый дескриптор только с наиболее релевантными кандидатами в его многомерной окрестности.  
Результат сопоставления ключевых точек между всеми изображениями:  
![keypoints_1](https://github.com/luckeroff02/Comp_vision_2/blob/main/matching.png)
